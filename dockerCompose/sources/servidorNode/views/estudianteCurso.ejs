<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudiante-Curso</title>
    <style>
        th,
        td,
        tr {
            padding: 10px 50px 10px 0;
            text-align: left;
        }
    </style>
</head>

<body>
    <h1>Aosciar Estudiante Con Curso</h1>
    <form id="asociarForm">
        <label for="estudianteID">ID Estudiante:</label>
        <input type="text" id="estudianteID" required>

        <label for="cursoID">ID Curso:</label>
        <input type="text" id="cursoID" required>

        <button type="submit">Agregar</button>
    </form>
    <br>
    <div id="messageAsociar"></div>
    <br>
    <h1>Eliminar Estudiante de Curso</h1>
    <form id="eliminarForm">
        <label for="estudianteIDEliminar">ID Estudiante:</label>
        <input type="text" id="estudianteIDEliminar" required>

        <label for="cursoIDEliminar">ID Curso:</label>
        <input type="text" id="cursoIDEliminar" required>

        <button type="submit">Eliminar</button>
    </form>
    <br>
    <div id="messageEliminar"></div>
    <br>
    <h1>Cursos Ranking</h1>
    <div id="cursosRanking"></div>

    <script>

        document.getElementById('asociarForm').addEventListener('submit', async function (evento) {
            evento.preventDefault();

            const estudianteID = parseInt(document.getElementById('estudianteID').value);
            const cursoID = parseInt(document.getElementById('cursoID').value);

            try {
                const response = await fetch('/enroll', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ estudianteID, cursoID })
                });

                const data = await response.json();

                document.getElementById('messageAsociar').innerText = data.message;

                if (data.success) {
                    setTimeout(() => {
                        window.location.href = '/estudianteCurso'
                    }, 1000);
                } else {
                    setTimeout(() => {
                        document.getElementById('messageAsociar').innerText = '';
                    }, 2000);
                }
                
            } catch (error) {
                console.error(error);
            }

        });

        document.getElementById('eliminarForm').addEventListener('submit', async function (evento) {
            evento.preventDefault();

            const estudianteIDEliminar = parseInt(document.getElementById('estudianteIDEliminar').value);
            const cursoIDEliminar = parseInt(document.getElementById('cursoIDEliminar').value);

            try {
                const response = await fetch(`/enroll/${estudianteIDEliminar}/${cursoIDEliminar}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                document.getElementById('messageEliminar').innerText = data.message;

                if (data.success) {
                    setTimeout(() => {
                        window.location.href = '/estudianteCurso'
                    }, 1000);
                } else {
                    setTimeout(() => {
                        document.getElementById('messageEliminar').innerText = '';
                    }, 2000);
                }



            } catch (error) {
                console.error(error);
            }

        });

        function crearTablaRannking(cursosRanking) {
            try {
                console.log(cursosRanking)
                const tableUsuariosCon = document.createElement('table');

                const headers = document.createElement('tr');

                const head1 = document.createElement('th');
                head1.textContent = 'ID';
                headers.appendChild(head1);
                const head2 = document.createElement('th');
                head2.textContent = 'Titulo';
                headers.appendChild(head2);
                const head3 = document.createElement('th');
                head3.textContent = 'Descripcion';
                headers.appendChild(head3);
                const head4 = document.createElement('th');
                head4.textContent = 'Duracion';
                headers.appendChild(head4);
                const head5 = document.createElement('th');
                head5.textContent = 'NÂº Estudiantes';
                headers.appendChild(head5);

                tableUsuariosCon.appendChild(headers);

                cursosRanking.forEach(curso => {
                    const fila = document.createElement('tr');

                    const idCelda = document.createElement('td');
                    idCelda.textContent = curso.id;
                    fila.appendChild(idCelda);

                    const tituloCelda = document.createElement('td');
                    tituloCelda.textContent = curso.titulo;
                    fila.appendChild(tituloCelda);

                    const descripcionCelda = document.createElement('td');
                    descripcionCelda.textContent = curso.descripcion;
                    fila.appendChild(descripcionCelda);

                    const duracionCelda = document.createElement('td');
                    duracionCelda.textContent = curso.duracion + ' horas';
                    fila.appendChild(duracionCelda);

                    const numEstudiantesCelda = document.createElement('td');
                    numEstudiantesCelda.textContent = curso.num_estudiantes;
                    fila.appendChild(numEstudiantesCelda);

                    tableUsuariosCon.appendChild(fila);
                });

                document.getElementById('cursosRanking').appendChild(tableUsuariosCon);

            } catch (error) {
                console.error(error);
            }
        }

        async function crearTablaRanking() {
            try {
                const response = await fetch('/ranking/courses', {
                    method: 'GET'
                });

                const data = await response.json();

                if (data.success) {
                    crearTablaRannking(data.cursosRanking);
                } else {
                    document.getElementById('').innerText = data.message;
                    setTimeout(() => {
                        document.getElementById('').innerText = '';
                    }, 2000);
                }

            } catch (error) {
                console.error(error);
            }
        }

        window.onload = () => {
            crearTablaRanking();
        }

    </script>

</body>

</html>